{"version":3,"file":"youtube-dl.js","sourceRoot":"","sources":["../../src/plugin/youtube-dl.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,kEAA8D;AAC9D,gFAAwD;AACxD,sCAA2C;AAK3C,MAAa,eAAgB,SAAQ,yBAAe;IAClD,YAAY,eAAe,GAAG,IAAI;QAChC,KAAK,EAAE,CAAC;QACR,IAAI,eAAe,EAAE;YACnB,+BAA+B;YAC/B,IAAA,qBAAQ,GAAE;iBACP,IAAI,CAAC,CAAC,OAAY,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,mCAAmC,OAAO,GAAG,CAAC,CAAC;iBAClF,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;iBACpB,KAAK,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,+DAA+D,CAAC,CAAC,CAAC;YAC9F,8BAA8B;SAC/B;IACH,CAAC;IACD,4DAA4D;IAC5D,KAAK,CAAC,QAAQ;QACZ,OAAO,IAAI,CAAC;IACd,CAAC;IACD,KAAK,CAAC,OAAO,CAAC,GAAW,EAAE,MAAmB;QAC5C,MAAM,IAAI,GAAQ,MAAM,IAAA,oBAAa,EAAC,GAAG,EAAE;YACzC,cAAc,EAAE,IAAI;YACpB,UAAU,EAAE,IAAI;YAChB,UAAU,EAAE,IAAI;YAChB,iBAAiB,EAAE,IAAI;SACxB,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;YACX,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;YAC1D,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC7C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAA6B,EAAE,EAAE,CAAC,IAAI,aAAI,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;YACnG,OAAO,IAAI,iBAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;SACnC;QACD,OAAO,IAAI,aAAI,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;IAChD,CAAC;IACD,KAAK,CAAC,YAAY,CAAC,GAAW;QAC5B,MAAM,IAAI,GAAG,MAAM,IAAA,oBAAa,EAAC,GAAG,EAAE;YACpC,cAAc,EAAE,IAAI;YACpB,UAAU,EAAE,IAAI;YAChB,UAAU,EAAE,IAAI;YAChB,iBAAiB,EAAE,IAAI;SACxB,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;YACX,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,OAAO,IAAI,CAAC,GAAG,CAAC;IAClB,CAAC;CACF;AA3CD,0CA2CC;AAED,kBAAe,eAAe,CAAC","sourcesContent":["import youtubeDlExec, { download } from \"@distube/youtube-dl\";\nimport ExtractorPlugin from \"../struct/ExtractorPlugin\";\nimport { Playlist, Song } from \"../struct\";\nimport type { OtherSongInfo } from \"..\";\nimport type { GuildMember } from \"discord.js\";\nimport type { YtResponse } from \"@distube/youtube-dl\";\n\nexport class YouTubeDLPlugin extends ExtractorPlugin {\n  constructor(updateYouTubeDL = true) {\n    super();\n    if (updateYouTubeDL) {\n      /* eslint-disable no-console */\n      download()\n        .then((version: any) => console.log(`[DisTube] Updated youtube-dl to ${version}!`))\n        .catch(console.error)\n        .catch(() => console.warn(\"[DisTube] Unable to update youtube-dl, using default version.\"));\n      /* eslint-enable no-console */\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async validate() {\n    return true;\n  }\n  async resolve(url: string, member: GuildMember) {\n    const info: any = await youtubeDlExec(url, {\n      dumpSingleJson: true,\n      noWarnings: true,\n      noCallHome: true,\n      preferFreeFormats: true,\n    }).catch(e => {\n      throw new Error(`[youtube-dl] ${e.stderr || e}`);\n    });\n    if (Array.isArray(info.entries) && info.entries.length > 0) {\n      info.source = info.extractor.match(/\\w+/)[0];\n      info.songs = info.entries.map((i: OtherSongInfo & YtResponse) => new Song(i, member, i.extractor));\n      return new Playlist(info, member);\n    }\n    return new Song(info, member, info.extractor);\n  }\n  async getStreamURL(url: string) {\n    const info = await youtubeDlExec(url, {\n      dumpSingleJson: true,\n      noWarnings: true,\n      noCallHome: true,\n      preferFreeFormats: true,\n    }).catch(e => {\n      throw new Error(`[youtube-dl] ${e.stderr || e}`);\n    });\n    return info.url;\n  }\n}\n\nexport default YouTubeDLPlugin;\n"]}